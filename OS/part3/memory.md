# 메모리

### 논리 메모리 (=가상 메모리 영역)
- 프로세스가 보는 메모리 영역
- CPU가 프로세스를 실행하면서 보는 주소 값을 논리 주소/ 가상 주소라고 함
  
### 물리 메모리
- 실제로 사용되는 메모리 영역
- 실제로 메모리에서 사용되는 주소

### 연속 메모리 할당
멀티 프로세스 환경에서 여러 프로세스를 메모리에 연속적으로 로드하는 방법

1. 고정 분할 방식
- 메모리 영역을 분할한 뒤 각 영역에 프로세스를 할당하는 방식
- 분할된 영역의 크기는 서로 다를 수 있고, 분할된 크기는 고정됨
- 메모리에 올릴 수 있는 프로세스 수와 크기가 제한된다는 단점이 있음
- fragmentation (단편화) 문제가 발생할 수 있음.
ex) 7MB로 분할한 곳에, 8MB, 6MB 두개가 들어간다고 가정하면 6MB만 들어갈 수 있고 8MB는 들어가지 못함. 하지만 14MB가 있긴 하고 ㅠㅠ

2. 가변 분할 방식
- 할당할 프로세스의 크기에 따라 메모리 공간을 분할하는 방식
- 메모리 할당 알고리즘을 이용해 가용 메모리 공간에서 프로세스가 로드될 수 있는 메모리 공간 찾음
  1. 최초 적합
  - 가용 메모리 공간에서 프로세스 크기만큼 비어있는 메모리 공간 찾아서 차례대로 로드하는 방식

  2. 최적 적합
  - 할당하려는 프로세스 크기 이상인 가용 메모리 공간 중에서 가장 작은 공간에 프로세스를 할당하는 방식
  - 모든 가용메모리 공간을 탐색해야됨

  3. 최악 적합
  - 할당하려는 프로세스 크기 이상힌 가용 메모리 공간 중에서 가장 큰 공간에 프로세스를 할당하는 방식
  - 모든 가용메묄 공간 탐색해야됨

### 비연속 메모리 할당
1. 페이징 (Paging)
- 프로세스의 논리 메모리 영역과 물리 메모리 영역을 각각 일정한 크기의 페이지와 프레임으로 나눈다
- 페이지와 프레임에는 각각 번호를 할당해 프로세스의 페이지와 메모리의 프레임을 매핑함
- 페이지와 프레임을 매핑하는 데 페이지 테이블을 사용한다

1-1. 페이징 기법
  - 계층적 페이징 : 페이지 테이블을 다시 페이지로 나눠 페이지 테이블 자체를 페이징 하는 방식, 멀티 레벨 페이징이라고도 함
  - 해시 페이지 테이블 : 해시 테이블의 각 항목에 저장된 연결 리스트에 페이지 번호를 해싱한 뒤 가상 페이지 번호와 비교하는 방식
  - 역 페이지 테이블 : 프레임을 이용해 페이지를 찾는 방식, 페이지로 프레임을 찾는 기존 방식과 반대

2. 세그먼테이션 (Segmentation)
- 프로세스의 메모리 영역을 논리적 단위인 세그먼트로 분할하여 메모리를 할당함
- 논리적 단위는 파일 내 단위 함수, 프로세스, 스택, 힙과 같은 영역을 의미함
- 세그먼트의 논리 주소를 물리 주소로 매핑하여, 세그먼트 번호를 인덱스로 사용하고, 세그먼트별 시작주소인 base와 길이인 limit을 저장함

### 가상 메모리
- 프로세스의 일부만 메모리에 로드되고, 나머지는 디스크에 둔 상태로 프로세스를 실행하는 방식
- 프로그램이 메모리 크기에 대한 제약을 덜 받을 수 있음
- 동시에 많은 프로그램을 실행함으로 CPU 이용률, 처리율을 높일 수 있음.
- 필요한 영역만 메모리에 로드에 스와핑 횟수를 줄여서 프로그램 실행 속도를 높일 수 있음.

### 요구 페이징
- 프로세스에서 필요한 페이지만 메모리에 로드하는 방식
- 페이지를 모두 메모리에 로드하지 않고, 초기에 필요한 영역만 로드한 후 다른 영역은 요청이 올 때만 메모리에 로드함.
- 프로그램 실행하다가 물리 메모리에 필요한 페이지가 없을 때 **페이지 폴트** 가 발생된다.

### 스레싱
- 동시에 일정 수 이상의 프로그램을 실행했을 때 오히려 CPU 이용률이 떨어지는 상황
- 가상 메모리를 구현하여 다중 프로그래밍을 하면 CPU 이용률이 높아짐. 일정 수 넘어가면 페이지 폴트가 자주 일어나서 CPU 이용률이 떨어질 수 있음.
- **워킹 세트** 를 설정하여 스레싱 예방 가능. (지역성을 기반으로, 자주 사용하는 페이지를 저장해두는 것)

### 캐시 메모리
- 속도가 느린, 빠른 장치 간의 속도차이로 생기는 병목 현상을 줄이기 위한 범용 메모리
- CPU와 메인 메모리 간의 데이터 접근 시 속도 차이를 줄이기 위해 사용함
- CPU에서 메인 메모리 가져올 때 자주 사용하는 데이터를 캐시 메모리에 따로 저장

* 지역성 : CPU가 자주 참조하는 데이터가 고르게 분포되지 않고 특정 부분에 몰려 있는 것
          - 캐시 적중률을 높이려면 지역성을 바탕으로 데이터를 저장해야됨

1. 시간 지역성 : 최근 참조한 내용을 다시 참조할 가능성이 높다.
2. 공간 지역성 : 실제 참조한 주소 근처의 내용을 참조할 가능성이 높다.

### 캐시 메모리의 매핑 방식
1. 직접 매핑
- 메인 메모리를 일정한 크기로 나누고 각 영역을 캐시 메모리에 매핑하는 방식
- n개로 나뉘어진 각 메모리 영역이 1개의 캐시 메모리에 매핑됨

2. 연관 매핑
- 메모리 영역을 캐시 메모리에 규칙 없이 매핑하는 방식
- 메모리 영역을 캐시 메모리에 적재할 때는 간단하지만, 캐시 메모리에서 필요한 메모리 찾을 땐 비효율적임

3. 집합 연관 매핑
- 직접 매핑과 연관 매핑을 결합하여 단점을 보완한 방식으로, 범용적으로 사용함
