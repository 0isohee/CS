# 프로세스와 스레드
<br/>

### 프로세스
컴퓨터에서 실행 중인 하나의 프로그램을 의미하며, 프로그램은 특정 작업을 수행하기 위한 명령어의 집합이다.
프로세스는 OS로부터 독립된 메모리 영역을 할당 받고, 다른 영역에는 접근할 수 없다.

### 프로세스의 메모리 영역 구조
<img width="400" alt="스크린샷 2024-07-29 오전 11 07 11" src="https://github.com/user-attachments/assets/5e621973-9048-49e8-a570-17ca114f541b"><br/>
1. 스택 : **LIFO** 으로 동작, 지역 변수, 함수의 매개변수, 반환되는 주소 값들이 저장되는 영역<br/>
2. 힙 : **FIFO** 으로 동작, 사용자에 의해 동적 메모리 할당이 일어나는 영역으로, malloc() 으로 할당되는 영역<br/>
3. 데이터 : 전역 변수, 정적 변수, 배열, 구조체 등이 저장되는 영역, **BSS(Block Stated Symbol)** 으로 초기화 되지 않은 영역과 초기화 된 영역으로 세분화됨<br/>
4. 코드 : 실행할 코드가 기계어로 컴파일 되어 동작하는 영역으로, 텍스트 영역이라 한다.<br/>

- 스택 영역이 힙 영역을 침범하는 것이 **스택 오버플로**, 힙 영역이 스택 영역을 침범하는 것을 **힙 오버플로** 라고 한다.
<br/>

### 스레드
스레드는 프로세스에서 실제로 실행되는 흐름의 단위를 의미. <br/>
스레드는 프로세스 안에 존재하기에, 프로세스의 메모리 공간을 이용하고, 지역 변수를 저장하는 스택 영역을 할당 받음. <br/>
전역 변수를 저장하는 힙 영역은 다른 스레드와 공유함
<br/>

### PCB (Process Control Block)
OS는 프로세스를 제어하기 위한 프로세스 정보를 저장하는데, 이를 PCB 라고 함. <br/>
프로세스의 현재 상태, 프로세스를 나타내는 고유의 Process ID, 다음 프로그램의 명령어 주소인 PC, 메모리 제한 등을 관리함<br/>

### 프로세스의 생성
새로운 프로세스는 기존 프로세스에서 fork() 함수를 호출해 생성함. <br/>
fork() 함수에는 함수를 호출한 프로세스를 복사하는 기능이 있음. 이때, 기존 프로세스를 부모, 복사된 프로세스를 자식 프로세스라고 함<br/>

함수 값 반환 예시
```
#include <stdio.h>
#include <unistd.h>

int main() {
  printf("Start!\n");
  int forkRet = fork();

  if (forkRet == 0){
    printf("child process : %d\n",getpid());
  } else {
    printf("forkRet : %d, parent process : %d\n", forkRet, getpid());
  }

  return 0;
}
```
<br/>
실행 결과 <br/>
> Start! <br/>
> forkRet : 136, parent process : 135 <br/>
> child process : 136
<br/>

<br/>
처음 부모에서 Start! 실행 후, fork() 실행시, 자식의 프로세스를 생성하게 됨. <br/>
따라서, 반환값은 자식의 PID인 136이 되고, else 문에 들어가서 출력문을 출력하게 됨 <br/>
자식 프로세스는 부모가 호출한 시점에 생성됨으로 반환값이 0이 되어 if문 안에 들어가게 되고, <br/>
자신의 PID을 호출하며 함수가 끝이 난다.
<br/>

### 프로세스의 상태도
생성 - 준비 - 대기 - 실행 - 종료의 5가지 상태가 있다. <br/>
<img width="600" src="https://user-images.githubusercontent.com/59963677/139288242-13e5faa3-9363-4387-8e4f-fa4f85af718a.png">

1. 생성 : 프로세스가 PCB을 가지고 있지만 OS로부터 승인 받기 전
2. 준비 : OS로부터 승인받은 후에 큐에서 CPU 할당을 기다림
3. 실행 : 프로세스가 CPU을 할당받아서 시행
4. 대기 : 프로세스가 입출력이나 이벤트 발생을 기다려야해서 CPU 사용을 멈추고 기다림
5. 종료 : 프로세스 실행 종료

### 멀티 프로세스와 멀티 스레드
* 동시성 : 하나의 코어에서 여러 작업을 번갈아가면서 처리하는 것. CPU는 한번에 하나만 처리할 수 있어서 여러 작업을 조금씩 번갈아가면서 처리하기 위해 처리 중인 작업을 교체하면서 처리함.
* 병렬성 : CPU가 여러 개 있어서, 각 CPU에서 각 작업을 동시에 처리하는 방식 (물리적 관점에서 동시에 여러 작업 실행!)

1. 멀티 프로세서
- 응용 프로그램 하나를 여러 프로세서로 구성하는 것으로 한 프로세서가 죽어도 다른 프로세스에 영향을 주지 않음 (따라서 여러 개로 구성하는 것이 안전!)
- 시간과 메모리를 많이 사용한다는 단점이 있음 <br/>
  : CPU는 하나의 작업만 사용할 수 있기에 콘텍스트 스위칭 과정에서 일어나는 오버헤드나, 프로세스 간의 공유해야할 자원이 있을 시 **IPC** 을 통해 해야된다. 따라서 직접 참조보다 비효율적임.
  
2. 멀티 스레드
- 스레드를 여러 개 생성해 스레드들이 각자 다른 작업을 처리하는 것을 의미
- 멀티 스레드는 스레드 간 힙,데이터,코드 영역을 공유함. 따라서, 오버헤드가 적고 IPC을 안해도 되어서 멀티 프로세스의 단점 보완이 가능
- 스택 영역을 다른 스레드 간 같이 사용함으로 공유 자원에 대한 동기화가 필수
- 스레드 내에 문제가 생길 시, 다른 스레드에도 영향이 생길 수 있음
<br/>

### Context Switching (컨텍스트 스위칭)

